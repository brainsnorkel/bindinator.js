<!-- Bind-O-Matic.js Copyright (c) 2016 Tonio Loewald -->
<head>
	<title>Bind-O-Matic</title>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism-okaidia.css">
	<link rel="stylesheet" type="text/css" href="bom.css">
</head>
<body>
	<div class="layout">
		<div class="header">
			<h1>Bind-O-Matic.js</h1>
		</div>
		<div class="three_col">
			<div class="nav">
				<h3>Documentation</h3>
				<div data-component="list">
					<div 
						class="loadable"
						data-list="source_files" 
						data-bind="text=.name;attr(data-path)=.path"
						data-event="mouseup:demo.showDocs"
					>
						File Name
					</div>
				</div>
				<h3>Components</h3>
				<div data-component="list">
					<div
						class="loadable "
						data-list="components"
						data-bind="text=.name;attr(data-path)=.path"
						data-event="mouseup:demo.loadComponent"
					>
						File Name
					</div>
				</div>
			</div>
			<div class="content">
				<h1 id="title">Middle</h1>
				<div id="example"></div>
				<div><pre><code style="font-size: 12px" id="source-code" class="language-markup"></code></pre></div>
			</div>
			<div class="nav">
				<h3>Tests</h3>
				<a href="tests.html">Unit Tests</a>
			</div>
		</div>
		<div class="footer">
			<div>
				&copy; 2016 Tonio Loewald | <a href="http://loewald.com">loewald.com</a> | <a href="LICENSE.txt">License</a>
			</div>
		</div>
	</div>
	<script src="require.js"></script>
	<script src="bom.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jshint/2.9.3/jshint.min.js"></script>
	<script>
		BOM.register('demo', {
			showDocs: function(evt) {
				window.location.hash = 'source=' + evt.target.getAttribute('data-path');
			},
			loadComponent: function(evt) {
				window.location.hash = 'component=' + evt.target.getAttribute('data-path');
			},
		});
		BOM.component('hello', 'components/hello');
		BOM.json('source-files.json').then(data => BOM.register('source_files', data));
		BOM.json('components.json').then(data => BOM.register('components', data));

		var title = BOM.id('title');
		var element = BOM.id('example');
		var source_code = BOM.id('source-code');

		function update() {
			var pairs = window.location.hash.substr(1).split('&').map(pair => {
				var [key, value] = pair.split('=');
				return {key, value};
			});
			if (pairs.length) {
				BOM.empty(element);
				BOM.hide(source_code.closest('div'));
				switch (pairs[0].key) {
					case 'source':
						title.textContent = pairs[0].value;
						BOM.component('file-viewer', 'components/file-viewer').then(viewer => {
							BOM.insertComponent(viewer, element, {url: pairs[0].value});
						});
						break;
					case 'component':
						BOM.component(pairs[0].value, 'components/' + pairs[0].value)
							 .then(component => {
							 		title.textContent = 'Component: ' + pairs[0].value;
							 		source_code.textContent = component._source.replace(/\t/g, '  ');
							 		require.lazy("https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/prism.min").then(() => {
							 			Prism.highlightElement(source_code);
							 			BOM.show(source_code.closest('div'));
							 		});
							 		BOM.insertComponent(component, element);
							 });
						break;
				}
			}
		}

		window.addEventListener('hashchange', update);

		update();
	</script>
</body>