const _delete_={},_new_object_={};function pathSplit(e){const[,t,,n,r]=e.match(/^(.*?)(([\.\[])(.*))?$/);return[t,"["===n?"["+r:r]}function pathParts(e){if(!e||"/"===e)return[];if(Array.isArray(e))return e;{const n=[];for(;e.length;){var t=e.search(/\[[^\]]+\]/);if(-1===t){n.push(e.split("."));break}{const r=e.substr(0,t);e=e.substr(t),r&&n.push(r.split(".")),t=e.indexOf("]")+1,n.push(e.substr(1,t-2)),"."===e.substr(t,1)&&(t+=1),e=e.substr(t)}}return n}}function buildKeypathValueMap(e,t){if(!e._b8r_value_maps){const t={};Object.defineProperty(e,"_b8r_value_maps",{get:()=>t})}const n={};return e.forEach((e,r)=>n[getByPath(e,t)+""]=r),e._b8r_value_maps[t]=n,n}function getKeypathMap(e,t){return e._b8r_value_maps&&e._b8r_value_maps[t]?e._b8r_value_maps[t]:buildKeypathValueMap(e,t)}function keyToIndex(e,t,n){let r=getKeypathMap(e,t)[n];return void 0!==r&&getByPath(e[r],t)+""==n+""||(r=buildKeypathValueMap(e,t)[n]),r}function byKey(e,t,n){return e[t]||(e[t]=n),e[t]}function byKeyPath(e,t,n,r){let a=t?keyToIndex(e,t,n):n;if(r===_delete_)return t?e.splice(a,1):delete e[a],null;if(r===_new_object_)t||e[a]||(e[a]={});else if(r)if(void 0!==a)e[a]=matchTypes(r,e[a]);else{if(!t||getByPath(r,t)+""!=n+"")throw`byKeyPath insert failed at [${t}=${n}]`;e.push(r),a=e.length-1}return e[a]}function expectArray(e){if(!Array.isArray(e))throw console.error("setByPath failed: expected array, found",e),"setByPath failed: expected array"}function expectObject(e){if(!e||e.constructor!==Object)throw console.error("setByPath failed: expected Object, found",e),"setByPath failed: expected object"}function getByPath(e,t){const n=pathParts(t);var r,a,s,o,i=e;for(r=0,a=n.length;i&&r<a;r++){var l=n[r];if(Array.isArray(l))for(s=0,o=l.length;i&&s<o;s++){i=i[l[s]]}else if(i.length)if(l.indexOf("=")>-1){const[e,...t]=l.split("=");i=byKeyPath(i,e,t.join("="))}else i=i[s=parseInt(l,10)];else i="="===l[0]?i[l.substr(1)]:void 0}return void 0===i?null:i}function setByPath(e,t,n){let r=e;const a=pathParts(t);for(;r&&a.length;){const e=a.shift();if("string"==typeof e){const t=e.indexOf("=");if(t>-1){if(0===t?expectObject(r):expectArray(r),r=byKeyPath(r,e.substr(0,t),e.substr(t+1),a.length?_new_object_:n),!a.length)return!0}else{expectArray(r);const t=parseInt(e,10);if(!a.length)return n!==_delete_?r[t]=matchTypes(n,r[t]):r.splice(t,1),!0;r=r[t]}}else{if(!Array.isArray(e)||!e.length)throw console.error("setByPath failed: bad path",t),"setByPath failed";for(expectObject(r);e.length;){const t=e.shift();if(!e.length&&!a.length)return n!==_delete_?r[t]=matchTypes(n,r[t]):delete r[t],!0;r=byKey(r,t,e.length?{}:[])}}}throw console.error(`setByPath failed: "${t}" not found in`,e),`setByPath(${e}, ${t}, ${n}) failed`}function deleteByPath(e,t){null!==getByPath(e,t)&&setByPath(e,t,_delete_)}function matchTypes(e,t){return null==e||null==t||typeof e==typeof t?e:"string"==typeof e&&"number"==typeof t?parseFloat(e):"string"==typeof t?e+"":"boolean"==typeof t?"false"!==e&&!!e:(void 0!==t&&null!==t&&console.warn("setByPath replaced",t,"with",e),e)}const makeArray=e=>[...e],forEach=(e,t)=>{for(let n=0;n<e.length&&!1!==t(e[n],n);n++);},last=e=>e.length?e[e.length-1]:null,forEachKey=(e,t)=>{const n=Object.keys(e);for(const r of n)if(!1===t(e[r],r))break},mapKeys=(e,t)=>{const n=Object.keys(e),r=[];for(const a of n)r.push(t(e[a],a));return r},mapEachKey=(e,t)=>{const n=Object.keys(e),r={};for(const a of n)r[a]=t(e[a],a);return r},findKey=(e,t)=>{const n=Object.keys(e);for(const r of n)if(t(e[r],r))return r;return null},findValue=(e,t)=>{const n=findKey(e,t);return n?e[n]:null},filterInPlace=(e,t)=>{for(let n=e.length-1;n>=0;n--)t(e[n],n)||e.splice(n,1)},filterKeys=(e,t)=>{const n=Object.keys(e),r=[];for(const a of n)t(e[a],a)&&r.push(a);return r},filterObject=(e,t)=>{const n=Object.keys(e),r={};for(const a of n)t(e[a],a)&&(r[a]=e[a]);return r},filterObjectInPlace=(e,t)=>{const n=Object.keys(e);for(const r of n)t(e[r],r)||delete e[r]},assignValues=(e,t)=>(forEachKey(t,(t,n)=>{"function"!=typeof t&&(t&&t.constructor===Object?e[n]=assignValues({},t):e[n]=t)}),e);var _iterators=Object.freeze({makeArray:makeArray,last:last,forEach:forEach,forEachKey:forEachKey,mapKeys:mapKeys,mapEachKey:mapEachKey,findKey:findKey,findValue:findValue,filterInPlace:filterInPlace,filterKeys:filterKeys,filterObject:filterObject,filterObjectInPlace:filterObjectInPlace,assignValues:assignValues});const isVisible=(e,t)=>e&&"none"!==getComputedStyle(e).display&&(!t||e===document.body||isVisible(e.parentElement,!0)),isInView=(e,t)=>{if(!e||!isVisible(e,!0))return!1;const n=e.getBoundingClientRect(),r=t?t.getBoundingClientRect():{left:0,top:0,width:window.innerWidth,height:window.innerHeight};return rectsOverlap(n,r)},rectsOverlap=(e,t)=>!(e.top>t.top+t.height||e.top+e.height<t.top||e.left>t.left+t.width||e.left+e.width<t.left),find=e=>makeArray(document.querySelectorAll(e)),findOne=document.querySelector.bind(document),findWithin=(e,t,n)=>{const r=makeArray(e.querySelectorAll(t));return n&&e.matches(t)&&r.unshift(e),r},findOneWithin=(e,t,n)=>n&&e.matches(t)?e:e.querySelector(t),succeeding=(e,t)=>{for(;e.nextElementSibling&&!e.nextElementSibling.matches(t);)e=e.nextElementSibling;return e.nextElementSibling},preceding=(e,t)=>{for(;e.previousElementSibling&&!e.previousElementSibling.matches(t);)e=e.previousElementSibling;return e.previousElementSibling},findAbove=(e,t,n,r)=>{let a=r?e:e.parentElement;const s=[];for(;a&&a!==document.body&&("string"!=typeof n||!a.matches(n))&&a!==n;)a.matches(t)&&s.push(a),a=a.parentElement;return s},id=document.getElementById.bind(document),text=document.createTextNode.bind(document),fragment=document.createDocumentFragment.bind(document),create=document.createElement.bind(document),classes=(e,t)=>{forEachKey(t,(t,n)=>{t?e.classList.add(n):e.classList.remove(n)})},styles=(e,t)=>{forEachKey(t,(t,n)=>e.style[n]=t)},empty=e=>{for(;e.lastChild;)e.lastChild.remove()},elementIndex=e=>[...e.parentElement.children].indexOf(e),moveChildren=(e,t)=>{for(;e.firstChild;)t.appendChild(e.firstChild)},copyChildren=(e,t)=>{let n=e.firstChild;for(;n;)t.appendChild(n.cloneNode(!0)),n=n.nextSibling},wrap=(e,t,n)=>{try{const r=e.parentElement,a=n?t.querySelector(n):t;r.insertBefore(t,e),a.appendChild(e)}catch(e){throw"wrap failed"}},unwrap=(e,t)=>{try{const n=t?e.closest(t):e.parentElement;n.parentElement.insertBefore(e,n),n.remove()}catch(e){throw"unwrap failed"}},within=(e,t,n)=>{const r=e.getBoundingClientRect(),{clientX:a,clientY:s}=t;return a+n>r.left&&a-n<r.right&&s+n>r.top&&s-n<r.bottom},isInBody=e=>e&&document.body.contains(e),cssVar=(e,t)=>{if(void 0===t){return getComputedStyle(document.querySelector("html")).getPropertyValue(e)}document.querySelector("html").style.setProperty(e,t)};var _dom=Object.freeze({isVisible:isVisible,isInView:isInView,rectsOverlap:rectsOverlap,find:find,findOne:findOne,findWithin:findWithin,findOneWithin:findOneWithin,succeeding:succeeding,preceding:preceding,findAbove:findAbove,id:id,text:text,fragment:fragment,create:create,classes:classes,styles:styles,empty:empty,elementIndex:elementIndex,moveChildren:moveChildren,copyChildren:copyChildren,wrap:wrap,unwrap:unwrap,within:within,isInBody:isInBody,cssVar:cssVar});const logs=[],medianOfSortedArray=e=>(e[Math.floor(e.length/2)]+e[Math.floor(e.length/2-.5)])/2;var _perf={log:(e,t,n=!1)=>{let r=logs.find(t=>t.name===e);r||(r={name:e,total_time:0,entries:[]},logs.push(r));let a=r.entries.find(e=>e.name===t);return a||(a={name:t,count:0,times:[],total_time:0,starts:[]},r.entries.push(a)),n&&r.entries.length>200&&(console.log("truncating log entries for",e),r.entries.splice(r.entries.length-100)),a},logStart:(e,t)=>{const n=perf.log(e,t);n.count+=1,n.starts.push(performance.now())},logEnd:(e,t)=>{const n=perf.log(e,t,!0),r=n.starts.pop(),a=logs.find(t=>t.name===e);void 0===r&&console.error("logEnd without corresponding logStart",e,t,n);const s=performance.now()-r;a.total_time+=s,n.total_time+=s,n.times.push(s)},elementSignature:e=>{let t=e.tagName;return e.classList.value?t+="."+e.classList.value.split(" ").join("."):e.parentElement&&(t=perf.elementSignature(e.parentElement)+">"+t),t},showLogs:(e,t)=>{if(e){var n=logs.find(t=>t.name===e).entries.map(e=>{const{name:t,count:n,times:r,total_time:a}=e;var s,o,i;if(r.length){const e=r.sort((e,t)=>e-t);s=e[0],o=e[e.length-1],i=medianOfSortedArray(e)}else s=o=i="";return{name:t,count:n,best:s,median:i,worst:o,total_time:a}});return t&&(n=n.filter(e=>e.worst>t)),console.table(n,["name","count","best","median","worst","total_time"]),n}return console.table(logs,["name","total_time"]),logs}};const dispatch=(e,t,...n)=>{const r=new Event(e);return r.args=n,t.dispatchEvent(r),r.target!==t?{type:e,target:t,args:n}:r};let _update_frame=null;const _update_list=[],_after_update_callbacks=[];let _force_update=()=>{};const requestAnimationFrameWithTimeout=e=>{let t=!1;const n=()=>{t||e(),t=!0};return requestAnimationFrame(n),setTimeout(n,20),{cancel:()=>t=!0}},get_update_list=()=>{if(_update_frame)return _update_frame.cancel(),_update_frame=null,_update_list.splice(0);if(_update_list.length)throw"_update_list is not empty but no _update_frame set";return!1},_after_update=()=>{for(;_after_update_callbacks.length;){let e;try{(e=_after_update_callbacks.shift())()}catch(t){console.error("_after_update_callback error",t,e)}}},async_update=(e,t)=>{const n=e?_update_list.find(t=>e.startsWith(t.path)):_update_list.find(e=>!e.path&&e.source&&e.source===t);n?e&&(n.source=t):(_update_frame||(_update_frame=requestAnimationFrameWithTimeout(_force_update)),_update_list.push({path:e,source:t}))},after_update=e=>{_update_list.length?-1===_after_update_callbacks.indexOf(e)&&_after_update_callbacks.push(e):e()},touchElement=e=>async_update(!1,e),touchByPath=(...e)=>{let t,n,r,a;e[1]instanceof HTMLElement?[t,n]=e:([r,a,n]=e,t=a&&"/"!==a?r+("["!==a[0]?".":"")+a:r),async_update(t,n)},_set_force_update=e=>_force_update=e,addDataBinding=(e,t,n)=>{const r=`${t}=${n=n.replace(/_component_/g,getComponentId(e))}`,a=(e.dataset.bind||"").split(";").map(e=>e.trim()).filter(e=>!!e);-1===a.indexOf(r)&&(a.push(r),e.dataset.bind=a.join(";"),Promise.resolve().then(function(){return b8r$2}).then(t=>{delete e._b8r_boundValues,touchElement(e)}))},removeDataBinding=(e,t,n)=>{const r=`${t}=${n}`;var a=(e.dataset.bind||"").split(";").map(e=>e.trim());a.indexOf(r)>-1&&((a=a.filter(e=>e!==r)).length?e.dataset.bind=a.join(";"):e.dataset.bind&&delete e.dataset.bind,delete e._b8r_boundValues)},parseBinding=e=>{if(!e.trim())throw"empty binding";if(-1===e.indexOf("="))throw"binding is missing = sign; probably need a source or target";const[,t,n]=e.trim().match(/^([^=]*)=([^;]*)$/m).map(e=>e.trim()),r=t.split(",").map(t=>{var n=t.match(/(\w+)(\(([^)]+)\))?/);if(n)return n?{target:n[1],key:n[3]}:null;console.error("bad target",t,"in binding",e)});return n||console.error("binding does not specify source",e),{targets:r,path:n}},splitPaths=e=>e.match(/(([^,(]+\([^)]+\))|([^,()]+))/g),findBindables=e=>findWithin(e,"[data-bind]",!0),findLists=e=>findWithin(e,"[data-list]",!0),getBindings=e=>e.dataset.bind.split(";").filter(e=>!!e.trim()).map(parseBinding),getDataPath=e=>{const t=!!e&&e.closest("[data-path],[data-list-instance]"),n=t?t.dataset.path||t.dataset.listInstance:"";return-1===[".","["].indexOf(n[0])?n:getDataPath(t.parentElement)+n},getListInstancePath=e=>{const t=e.closest("[data-list-instance]");return t?t.dataset.listInstance:null},getComponentId=(e,t)=>{t&&(e=e.closest(`.${t}-component`));const n=e.closest("[data-component-id]");return n?n.dataset.componentId:null},replaceInBindings=(e,t,n)=>{const r=new RegExp(t,"g");findWithin(e,`[data-bind*="${t}"],[data-list*="${t}"],[data-path*="${t}"]`).forEach(e=>{["data-bind","data-list","data-path"].forEach(t=>{const a=e.getAttribute(t);a&&e.setAttribute(t,a.replace(r,n))})})},resolveListInstanceBindings=(e,t)=>{findWithin(e,"[data-bind]",!0).filter(e=>!e.closest("[data-list]")).forEach(e=>{const n=e.dataset.bind;n.indexOf("=.")>-1&&(e.dataset.bind=n.replace(/\=\.([^;\s]+)/g,`=${t}.$1`).replace(/\=\./g,`=${t}`)),n.indexOf("${.")>-1&&(e.dataset.bind=n.replace(/\$\{(\.[^\}]+)\}/g,"${"+t+"$1}"))})},registry={},listeners=[],valid_path=/^\.?([^.[\](),])+(\.[^.[\](),]+|\[\d+\]|\[[^=[\](),]*\=[^[\]()]+\])*$/,isValidPath=e=>valid_path.test(e);class Listener{constructor(e,t){if(this._orig_test=e,"string"==typeof e)this.test=(t=>t.length>=e.length&&e===t.substr(0,e.length));else if(e instanceof RegExp)this.test=e.test.bind(e);else{if(!(e instanceof Function))throw"expect listener test to be a string, RegExp, or test function";this.test=e}if("string"==typeof t)this.callback=((...e)=>{get(t)?call(t,...e):unobserve(this)});else{if("function"!=typeof t)throw"expect callback to be a path or function";this.callback=t}listeners.push(this)}}const resolvePath=(e,t)=>{if("."===e[0]){if(!t)throw"cannot evaluate relative path without element";e=getDataPath(t)+e}else if("_data_"===e.substr(0,6)){if(!t)throw"cannot evaluate _data_ path without element";e=getDataPath(t)+e.substr(6)}else if("_component_"===e.substr(0,11)){if(!t)throw"cannot evaluate _component_ path without element";e=getComponentId(t)+e.substr(11)}return e},_compute=(e,t)=>{const[,n,r]=e.match(/([^(]+)\(([^)]+)\)/);return-1===r.indexOf(",")?call(n,get(r,t)):call(n,...get(r,t))},_get=(e,t)=>{if(")"===e.substr(-1))return _compute(e,t);if(e.startsWith(".")){const n=t.closest("[data-list-instance]");return n?getByPath(n._b8r_listInstance,e.substr(1)):void 0}if(e=resolvePath(e,t),isValidPath(e))return getByPath(registry,e);console.error(`getting invalid path ${e}`)},get=(e,t)=>{const n=splitPaths(e);return 1===n.length?_get(n[0],t):n.map(e=>_get(e,t))},getJSON=(e,t,n)=>{const r=get(e,t),a=[];return JSON.stringify(r,(e,t)=>t&&"object"==typeof t?"object"==typeof t?t.constructor!==Object&&t.constructor!==Array?`[${t.constructor.name}]`:-1===a.indexOf(t)?(a.push(t),t):"[duplicate or circular reference]":void 0:t,n?2:0)},touch=(e,t)=>{listeners.filter(t=>t.test(e)).forEach(n=>n.callback(e,t))},set=(e,t,n)=>{isValidPath(e)||console.error(`setting invalid path ${e}`);const r=e.split(/\.|\[/),a=r[0],s=getByPath(registry,e);if(r.length>1&&!registry[a])console.error(`cannot set ${e} to ${t}, ${a} does not exist`);else{if(1===r.length&&"object"!=typeof t)throw`cannot set ${e}; you can only register objects at root-level`;t===s?(Array.isArray(t)||Array.isArray(s))&&touch(e,n):t&&t.constructor?1!==r.length||registry[e]?(t.constructor===Object&&s&&s.constructor===Object?setByPath(registry,e,Object.assign(t,Object.assign({},s,t))):setByPath(registry,e,t),touch(e,n)):register(e,t):(setByPath(registry,e,t),touch(e,n))}return t},_register=(e,t)=>{registry[e]=t},register=(e,t,n)=>{if(e.match(/^_[^_]*_$/))throw"cannot register object as "+e+", all names starting and ending with a single '_' are reserved.";_register(e,t),n||(touch(e),Promise.resolve().then(function(){return b8r_events}).then(({play_saved_messages:t})=>t(e)))},setJSON=(e,t)=>set(e,JSON.parse(t)),push=(e,t,n)=>{const r=get(e)||set(e,[]);Array.isArray(r)&&(r.push(t),n&&n(r),touch(e))},unshift=(e,t)=>{const n=get(e)||set(e,[]);Array.isArray(n)&&(n.unshift(t),touch(e))},sort=(e,t)=>{const n=get(e)||set(e,[]);Array.isArray(n)&&(n.sort(t),touch(e))},call=(e,...t)=>{const n=get(e);if(n instanceof Function)return n(...t);console.error(`cannot call ${e}; not a method`)},call_if=(e,...t)=>{const n=get(e);return n instanceof Function?n(...t):null},observe=(e,t)=>new Listener(e,t),unobserve=e=>{let t,n=!1;if(e instanceof Listener)(t=listeners.indexOf(e))>-1?listeners.splice(t,1):console.error("unobserve failed, listener not found");else if(e)for(let t=listeners.length-1;t>=0;t--)listeners[t]._orig_test===e&&(listeners.splice(t,1),n=!0);return n},models=()=>Object.keys(registry),registered=e=>!!registry[e.split(".")[0]],remove=(e,t=!0)=>{deleteByPath(registry,e),t&&(touch(e),[,e]=e.match(/^(.+)\[[^\]]+\]$/)||[],e&&touch(e))},zero=e=>set(e,0),increment=e=>set(e,get(e)+1),decrement=e=>set(e,get(e)-1),deregister=e=>{console.warn("deregister is deprecated, use b8r.remove"),remove(e)},_getByPath=(e,t)=>get(t?e+("["===t[0]?t:"."+t):e);var _registry=Object.freeze({get:get,getJSON:getJSON,getByPath:_getByPath,set:set,setJSON:setJSON,increment:increment,decrement:decrement,zero:zero,push:push,unshift:unshift,sort:sort,call:call,call_if:call_if,touch:touch,observe:observe,unobserve:unobserve,models:models,_register:_register,register:register,registered:registered,remove:remove,deregister:deregister,resolvePath:resolvePath,isValidPath:isValidPath});const debounce=(e,t)=>{let n;return(...r)=>{n&&clearTimeout(n),n=setTimeout(()=>e(...r),t)}},throttle=(e,t)=>{let n=Date.now()-t;return(...r)=>{const a=Date.now();a-n>t&&(n=a,e(...r))}},AsyncFunction=async function(){}.constructor;var _functions=Object.freeze({AsyncFunction:AsyncFunction,debounce:debounce,throttle:throttle});const render=e=>{const t=document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d");return n.fillStyle=e||"rgba(255,255,255,0.3)",n.fillRect(0,0,1,1),t.toDataURL()},images={},pixel=new Image;pixel.src=render();const pixelPromise=new Promise(e=>e(pixel)),imagePromise=(e,t=!0)=>e?images[e]?images[e]:(images[e]=new Promise(n=>{const r=new Image;t&&r.setAttribute("crossorigin","anonymous"),r.src=e,r.onload=(()=>{n(r)}),r.onerror=(()=>{n(pixel)})}),images[e]):pixelPromise,imgSrc=(e,t,n=!0)=>{e instanceof HTMLImageElement&&e.src===t||(e.src=pixel.src,e.style.opacity=.1,imagePromise(t,n).then(t=>{if(getComputedStyle(e).transition||(e.style.transition="0.25s ease-out"),e.style.opacity="",e.classList.add("-b8r-rendered"),e instanceof HTMLCanvasElement){e.width=e.offsetWidth,e.height=e.offsetHeight;const n=e.getContext("2d"),r=e.offsetWidth,a=e.offsetHeight,s=Math.max(r/t.width,a/t.height),o=r/s,i=a/s,l=.5*(t.width-o),c=.5*(t.height-i);n.drawImage(t,l,c,o,i,0,0,r,a)}else e.setAttribute("src",t.src)}))},anyElement=document.createElement("div"),keycode=e=>{if(e.code)return e.code.replace(/Key|Digit/,"");{let t=e.keyIdentifier;return"U+"===t.substr(0,2)&&(t=String.fromCharCode(parseInt(e.keyIdentifier.substr(2),16))),t}},keystroke=e=>{const t=[];return e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),e.shiftKey&&t.push("shift"),t.push(keycode(e)),t.join("-")},modifierKeys={meta:"⌘",ctrl:"⌃",alt:"⌥",escape:"⎋",shift:"⇧"};var implicit_event_types=["mousedown","mouseup","mousemove","mouseover","mouseout","click","dblclick","mouseleave","mouseenter","mousewheel","scroll","contextmenu","dragstart","dragenter","dragover","dragleave","dragend","drop","transitionend","animationend","input","change","keydown","keyup","cut","copy","paste","focus","blur"];const onOffArgs=e=>{var t,n,r,a,s=!1;if("object"==typeof e[2])return console.warn("b8r.on(element, type, OBJECT) is deprecated"),[t,n,r]=e,on(t,n,r.model,r.method);if(e.length>4||"string"==typeof e[3]){if([t,n,r,a,s]=e,"string"!=typeof r||"string"!=typeof a)return void console.error("implicit bindings are by name, not",r,a);a=r+"."+a}else[t,n,a,s]=e;if(!(t instanceof Element))throw console.error("bind bare elements please, not",t),"bad argument";return{element:t,event_type:n,path:a,prepend:s}},getEventHandlers=e=>{const t=e.dataset.event;return t?t.replace(/\s*(^|$|[,:;])\s*/g,"$1").split(";").filter(e=>e.trim()):[]},getParsedEventHandlers=e=>{const t=getEventHandlers(e);try{return t.map(function(t){const[n,r]=t.split(":");if(!r)return t.indexOf(".")?console.error("bad event handler (missing event type)",t,"in",e):console.error("bad event handler (missing handler)",t,"in",e),{types:[]};const[,a,s]=r.trim().match(/^([^\.]+)\.(.+)$/),o=n.split(",").sort();return{types:o.map(e=>e.split("(")[0].trim()),type_args:o.map(e=>{"key"===e.substr(0,3)&&(e=(e=e.replace(/Key|Digit/g,"")).replace(/CmdOrCtrl/g,navigator.userAgent.indexOf("Macintosh")>-1?"meta":"ctrl"));var t=e.match(/\(([^)]+)\)/);return!(!t||!t[1])&&t[1].split(",")}),model:a,method:s}})}catch(e){return console.error("fatal error in event handler",e),[]}},makeHandler=(e,t)=>{if("string"==typeof e&&(e=[e]),Array.isArray(e))return e.sort().join(",")+":"+t;console.error("makeHandler failed; bad event_type",e)};function on(...e){const{element:t,event_type:n,path:r,prepend:a}=onOffArgs(e),s=makeHandler(n,r),o=getEventHandlers(t);-1===o.indexOf(s)&&(a?o.unshift(s):o.push(s),t.dataset.event=o.join(";"))}function off(...e){var t,n,r,a;if(4===e.length)[t,n,r,a]=e,a=r+"."+a;else{if(3!==e.length)throw"b8r.off requires three or four arguments";[t,n,a]=e}const s=t.dataset.event.split(";"),o=makeHandler(n,a),i=s.indexOf(o);i>-1&&(s.splice(i,1),s.length?t.dataset.event=s.join(";"):t.dataset.event&&delete t.dataset.event)}const disable=(e,t)=>{(t?findWithin(e,"[data-event]",!0):[e]).forEach(e=>{e.dataset.event&&(e.dataset.eventDisabled=e.dataset.event,e.dataset.event&&delete e.dataset.event),e.disabled||(e.disabled=!0)})},enable=(e,t)=>{(t?findWithin(e,"[data-event-disabled]",!0):[e]).forEach(e=>{e.dataset.eventDisabled&&(e.dataset.event=e.dataset.eventDisabled,e.dataset.eventDisabled&&delete e.dataset.eventDisabled),e.disabled&&(e.disabled=!1)})};window.TouchEvent&&["touchstart","touchcancel","touchmove","touchend"].forEach(e=>implicit_event_types.push(e));const get_component_with_method=function(e,t){var n=!1;for(e=e.closest("[data-component-id]");e instanceof Element;){if(get(`${e.dataset.componentId}.${t}`)instanceof Function){n=e.dataset.componentId;break}e=e.parentElement.closest("[data-component-id]")}return n};var saved_messages=[];function saveMethodCall(e,t,n){saved_messages.push({model:e,method:t,args:n})}const play_saved_messages=e=>{for(var t=[],n=saved_messages.length-1;n>=0;n--)saved_messages[n].model===e&&(t.push(saved_messages[n]),saved_messages.splice(n,1));for(;t.length;){var{model:r,method:a,args:s}=t.pop();callMethod(r,a,...s)}},callMethod=(...e)=>{var t,n;try{e[0].match(/[\[.]/)?([n,...e]=e,[t,n]=pathSplit(n)):[t,n,...e]=e}catch(e){}var r=null;return registered(t)?r=call(`${t}.${n}`,...e):saveMethodCall(t,n,e),r},handle_event=e=>{for(var t=anyElement,n=e.args||[],r=e instanceof KeyboardEvent?keystroke(e):{};t;){for(var a=getParsedEventHandlers(t),s=!1,o=0;o<a.length;o++)for(var i=a[o],l=0;l<i.types.length;l++)if(i.types[l]===e.type&&(!i.type_args[l]||i.type_args[l].indexOf(r)>-1)){if(!i.model||!i.method){console.error("incomplete event handler on",t);break}if("_component_"===i.model&&(i.model=get_component_with_method(t,i.method)),i.model?s=callMethod(i.model,i.method,e,t,...n):console.warn(`_component_.${i.method} not found`,t),!0!==s)return e.stopPropagation(),void e.preventDefault()}t=t===anyElement?e.target.closest("[data-event]"):t.parentElement.closest("[data-event]")}},trigger=(e,t,...n)=>{if("string"==typeof e&&(!t||t.dispatchEvent instanceof Function))if(t)dispatch(e,t,...n);else console.warn("b8r.trigger called with no specified target");else console.error("expected trigger(event_type, target_element)",e,t)},implicitlyHandleEventsOfType=e=>{-1===implicit_event_types.indexOf(e)&&(implicit_event_types.push(e),document.body.addEventListener(e,handle_event,!0))};var b8r_events=Object.freeze({makeHandler:makeHandler,getEventHandlers:getEventHandlers,getParsedEventHandlers:getParsedEventHandlers,dispatch:dispatch,trigger:trigger,on:on,off:off,enable:enable,disable:disable,callMethod:callMethod,implicitlyHandleEventsOfType:implicitlyHandleEventsOfType,implicit_event_types:implicit_event_types,get_component_with_method:get_component_with_method,handle_event:handle_event,play_saved_messages:play_saved_messages});function describe(e,t=4,n=!1){if(void 0===e)return"undefined";if(!Array.isArray(e)){if(e&&e.constructor===Object){const n=Object.keys(e);return t>=0&&n.length>t&&(n.splice(t),n.push("…")),`{${n.join(",")}}`}if("string"==typeof e)return n?"string":`"${e}"`;if(e instanceof Function){const t=e.toString(),n=t.match(/^(async\s+)?(function[^(]*\()?\(?(.*?)(\)\s*\{|\)\s*=>|=>)/m)[3].trim(),r=t.match(/\[native code\]/),a=r?"[native code]":"...";let s=e.prototype||r?`function(${n}){${a}}`:`(${n})=>{${a}}`;return t.startsWith("async")&&(s="async "+s),s}return isNaN(e)?"NaN":"boolean"==typeof e?n?"bool":""+e:"number"==typeof e?n?"#":""+e:JSON.stringify(e)}return 0===e.length?"[]":1===e.length||typeof e[0]==typeof e[1]?`[${describe(e[0],t,n)} × ${e.length}]`:typeof e[0]!=typeof e[1]?e.length<=t||t<0?"["+e.map(e=>describe(e,t,n)).join(", ")+"]":`[* × ${e.length}]`:void 0}function _toTargets(e){const t={_true_:!0,_false_:!1,_undefined_:void 0,_null_:null},n=(e,n)=>("string"==typeof n&&(n=n.replace(/\&nbsp;/g,"").trim()),t.hasOwnProperty(e)?n===t[e]:void 0!==e?n==e:!!n),r=e=>{if(!e)throw"expected options";return e.split("|").map(e=>e.trim()).filter(e=>!!e).map(e=>1===(e=e.split(":").map(e=>e.trim())).length?{value:e[0]}:{match:e[0],value:e[1]})};return{value:function(t,n){switch(t.getAttribute("type")){case"radio":t.checked!==(t.value==n)&&(t.checked=t.value==n);break;case"checkbox":t.checked=n;break;default:void 0!==t.value?(t.value=n,n&&!t.value?t.dataset.pendingValue=JSON.stringify(n):t.dataset.pendingValue&&delete t.dataset.pendingValue):t.dataset.componentId?e.set(`${t.dataset.componentId}.value`,n):"B8R-COMPONENT"!==t.tagName&&console.error("could not set component value",t,n)}},checked:(e,t)=>{null===t?(e.checked=!1,e.indeterminate=!0):e.checked=!!t},selected:(e,t)=>{e.selected=!!t},text:(e,t)=>e.textContent=t,format:(t,n)=>{let r=n||"";if("string"!=typeof r)throw"format only accepts strings or falsy values";let a=!1;r.match(/[*_]/)&&!r.match(/<|>/)&&(a=!0,r=r.replace(/[*_]{2,2}(.*?)[*_]{2,2}/g,"<b>$1</b>").replace(/[*_](.*?)[*_]/g,"<i>$1</i>")),r.indexOf("${")>-1&&(r=e.interpolate(r,t)),a?t.innerHTML=r:t.textContent=r},fixed:(e,t,n)=>e.textContent=parseFloat(t).toFixed(n||1),bytes:(e,t)=>{if(!t)return void(e.textContent="");const n=["B","kB","MB","GB","TB","PB","EB"];let r=n.shift();for(e.title=`${t} bytes`;t>1024&&r.length;)t=(t/1024).toFixed(1),r=n.shift();e.textContent=`${t} ${r}`},attr:function(e,t,n){void 0===t||null===t||!1===t?e.removeAttribute(n):e.setAttribute(n,t)},prop:function(e,t,n){e[n]=t},data:function(e,t,n){void 0===t||null===t||!1===t?delete e.dataset[n]:e.dataset[n]=t},img:imgSrc,bgImg:(e,t)=>{e.style.backgroundImage=t?`url("${t}")`:""},style:function(e,t,n){n?void 0!==t&&(e.style[n]=t):"string"==typeof t?e.setAttribute("style",n):"object"==typeof t&&Object.assign(e.style,t)},class:function(e,t,n){if(!n)throw"class toTarget requires a class to be specified";const a=r(n);e.classList.toggle(a[0].value,!!t),a.length>1&&e.classList.toggle(a[1].value,!t)},class_unless:function(e,t,n){if(!n)throw"class_unless toTarget requires a class to be specified";t?e.classList.remove(n):e.classList.add(n)},class_map:function(e,t,a){let s=!1;r(a).forEach(r=>{s||r.match&&!n(r.match,t)?e.classList.remove(r.value):(e.classList.add(r.value),s=!0)})},contenteditable:function(e,t,r){n(r,t)?e.setAttribute("contenteditable",!0):e.removeAttribute("contenteditable")},enabled_if:function(t,r,a){n(a,r)?e.enable(t):e.disable(t)},disabled_if:function(t,r,a){n(a,r)?e.disable(t):e.enable(t)},pointer_events_if:function(e,t){e.style.pointerEvents=t?"auto":"none"},pointer_events_off_if:function(e,t){e.style.pointerEvents=t?"none":"auto"},show_if:function(t,r,a){n(a,r)?e.show(t):e.hide(t)},hide_if:function(t,r,a){n(a,r)?e.hide(t):e.show(t)},method:function(t,n,r){let[a,...s]=r.split(".");s=s.join("."),"_component_"===a&&(a=get_component_with_method(t,s)),a?e.callMethod(a,s,t,n):t.closest("body")&&console.warn(`method ${s} not found in`,t)},timestamp:function(e,t,n){if(t)if(n)Promise.resolve().then(function(){return date_format}).then(()=>{const r=new Date(t);e.textContent=r.format(n)});else{const n=new Date(t);e.textContent=n.toLocaleString()}else e.textContent=""},json:function(e,t){try{e.textContent=JSON.stringify(t,!1,2)}catch(n){const r={};Object.keys(t).forEach(e=>{r[e]=describe(t[e])}),e.textContent="/* partial data -- could not stringify */\n"+JSON.stringify(r,!1,2)}},data_path:function(t,n){(!t.dataset.path||n&&t.dataset.path.substr(-n.length)!==n)&&(t.dataset.path=n,e.bindAll(t))},component:function(t,n,r){const a=e.getComponentId(t);e.setByPath(a,r,n)},component_map:function(t,n,a){const s=r(a).find(e=>!e.match||e.match==n);if(s){const n=s.value;-1===(t.dataset.componentId||"").indexOf(`c#${n}#`)&&(e.removeComponent(t),e.insertComponent(n,t))}}}}const _requests_in_flight=[],_remove_in_flight_request=e=>{const t=_requests_in_flight.indexOf(e);t>-1&&_requests_in_flight.splice(t,1)},ajax=(e,t,n,r)=>new Promise(function(a,s){(r=r||{}).headers||(r.headers={});var o=new XMLHttpRequest;if(_requests_in_flight.push(o),o.open(t||"GET",e,!0),o.onreadystatechange=(()=>{if(o.readyState===XMLHttpRequest.DONE)switch(Math.floor(o.status/100)){case 0:case 5:case 4:_remove_in_flight_request(o),s(o);break;case 3:break;case 2:_remove_in_flight_request(o),a(o.responseText)}}),"object"==typeof n){if("GET"===t)throw"GET requests do not support request body data";n=JSON.stringify(n),r.headers["Content-Type"]="application/json; charset=utf-8"}for(var i in r.headers)o.setRequestHeader(i,r.headers[i]);o.send(n)}),json=(e,t,n,r)=>new Promise(function(a,s){ajax(e,t,n,r).then(e=>{try{a(JSON.parse(e||"null"))}catch(t){console.error("Failed to parse data",e,t),s(t,e)}},s)}),jsonp=(e,t,n,r)=>new Promise(function(a,s){ajax(e,t,n,r).then(e=>{let t="null";try{t=JSON.parse(e)}catch(t){console.error("Failed to parse data",e,t),s(t,e)}a(t)},s)}),ajax_requests_in_flight=()=>_requests_in_flight;var _ajax=Object.freeze({ajax:ajax,json:json,jsonp:jsonp,ajax_requests_in_flight:ajax_requests_in_flight});const value=e=>{let t=e.dataset.pendingValue;if(t&&(t=JSON.parse(t),e.value=t,e.value===t&&e.dataset.pendingValue&&delete e.dataset.pendingValue),e.matches("input[type=radio]")){const t=e.getAttribute("name"),n=find(`input[type=radio][name=${t}]`).find(e=>e.checked);return n?n.value:null}return e.dataset.componentId?get(`${e.dataset.componentId}.value`):e.value},checked=e=>e.indeterminate?null:e.checked,selected=e=>e.selected,text$1=e=>e.textContent,currentTime=e=>e.currentTime,playbackRate=e=>e.playbackRate,prop=(e,t)=>e[t],component=(e,t)=>{const n=e.dataset.componentId;return _getByPath(n,t)},fromMethod=(e,t)=>{let[n,...r]=t.split(".");return r=r.join("."),_getByPath(n,r)(e)};var fromTargets=Object.freeze({value:value,checked:checked,selected:selected,text:text$1,currentTime:currentTime,playbackRate:playbackRate,prop:prop,component:component,fromMethod:fromMethod}),_b8r_=e=>{const t=e=>fromTargets[e.target];e._register("_b8r_",{echo:e=>console.log(e)||!0,stopEvent:()=>{},_update_:n=>{let r=e.findAbove(n.target,"[data-bind]",null,!0);if("SELECT"===n.target.tagName){const t=e.findWithin(n.target,"option[data-bind]:not([data-list])");r=r.concat(t)}return r.filter(e=>!e.matches("[data-list]")).forEach(n=>{const r=getBindings(n);for(let a=0;a<r.length;a++){const{targets:s,path:o}=r[a],i=t=>{const r=fromTargets[t.target](n,t.key);void 0!==r&&(delete n._b8r_boundValues,e.setByPath(o,r,n))};s.filter(t).forEach(i)}}),!0}})};const sortAscending=(e,t)=>"string"==typeof e||"string"==typeof t?`${e}`.localeCompare(t):e>t?1:t>e?-1:0,sortDescending=(e,t)=>"string"==typeof e||"string"==typeof t?`${t}`.localeCompare(e):e>t?-1:t>e?1:0;var _sort=Object.freeze({sortAscending:sortAscending,sortDescending:sortDescending});const data_waiting_for_components=[],saveDataForElement=(e,t)=>{t&&(removeDataForElement(e),data_waiting_for_components.push({target_element:e,data:t}))},removeDataForElement=e=>{for(var t=0;t<data_waiting_for_components.length;t++)data_waiting_for_components[t].target_element===e&&delete data_waiting_for_components[t].data},dataForElement=(e,t)=>{for(var n,r=0;r<data_waiting_for_components.length;r++)if(data_waiting_for_components[r].target_element===e)return n=data_waiting_for_components[r].data,removeDataForElement(e),n;const a=e.dataset.json;return a?JSON.parse(a):t},anyArgs=e=>{var t,n,r,a;return 2===e.length?[t,a]=e:([t,n,r]=e,a=n+"."+r),{event_type:t,path:a}},onAny=function(...e){const{event_type:t,path:n}=anyArgs(e);on(anyElement,t,n)},offAny=function(...e){const{event_type:t,path:n}=anyArgs(e);off(anyElement,t,n)},anyListeners=()=>getEventHandlers(anyElement),show=(e,...t)=>{isVisible(e)||(void 0===e.dataset.origDisplay&&(e.dataset.origDisplay="none"===e.style.display?"":e.style.display),e.style.display=e.dataset.origDisplay,findWithin(e,'[data-event*="show"]',!0).forEach(e=>trigger("show",e,...t)))},hide=(e,...t)=>{isVisible(e)&&(void 0===e.dataset.origDisplay&&(e.dataset.origDisplay=e.style.display,findWithin(e,'[data-event*="hide"]',!0).forEach(e=>trigger("hide",e,...t))),e.style.display="none")},makeStyleSheet=(e,t)=>{const n=!!e&&create("style");return n&&(n.type="text/css",n.dataset.title=t,n.appendChild(text(e)),document.head.appendChild(n)),n},randomBytes="undefined"==typeof window?()=>{return require("crypto").randomBytes(16)}:()=>{const e=new Uint8Array(16);return window.crypto.getRandomValues(e),e},uuid=()=>{const e=randomBytes();e[8]=e[8]>>2|128,e[6]=e[6]>>4|64;let t=0;return"xxxx-xx-xx-xx-xxxxxx".replace(/x/g,()=>(3840|e[t++]).toString(16).slice(1))},appendContentToElement=(e,t)=>{if(t)if("string"==typeof t)e.textContent=t;else if(Array.isArray(t))t.forEach(t=>e.appendChild(t.cloneNode(!0)));else{if(!t.cloneNode)throw"expect text content or document node";e.appendChild(t.cloneNode(!0))}},makeElement=(e,{content:t=!1,attributes:n={},styles:r={},classes:a=[]})=>{const s=document.createElement(e);return appendContentToElement(s,t),Object.keys(n).forEach(e=>s.setAttribute(e,n[e])),Object.keys(r).forEach(e=>s.style[e]=r[e]),a.forEach(e=>s.classList.add(e)),s},slot=(e={})=>makeElement("slot",e),_hyphenated=e=>e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),_css=e=>{if("object"==typeof e){return Object.keys(e).map(t=>{const n=e[t];return`${t} {\n${Object.keys(n).map(e=>`  ${_hyphenated(e)}: ${n[e]};`).join("\n")}\n}`}).join("\n\n")}return e},unmountWatchList=[],unmountObserver=new MutationObserver(e=>{if(0!==unmountWatchList.length){for(let t=0;t<e.length;t++){if(e[t].removedNodes.length)break}for(let e=unmountWatchList.length-1;e>=0;e--){const t=unmountWatchList[e];document.body.contains(t)||(t.unMount(),unmountWatchList.splice(e,1))}}});unmountObserver.observe(document.body,{childList:!0,attributes:!0,subtree:!0});const makeWebComponent=(e,{superClass:t=HTMLElement,value:n=!1,style:r=!1,methods:a={},eventHandlers:s={},props:o={},attributes:i={},content:l=slot(),ariaRole:c=!1})=>{let d=null;r?(r=Object.assign({":host([hidden])":{display:"none !important"}},r),d=makeElement("style",{content:_css(r)})):r&&console.error(`style for a web-component ${e} with now shadowRoot is not supported`),a.render&&(a=Object.assign({queueRender(e=!1){this._changeQueued||(this._changeQueued=e),this._renderQueued||(this._renderQueued=!0,requestAnimationFrame(()=>{this._changeQueued&&this.dispatchEvent(new Event("change")),this._changeQueued=!1,this._renderQueued=!1,this.render()}))}},a));const u=class extends t{constructor(){if(super(),Object.assign(this,o),d){const e=this.attachShadow({mode:"open"});e.appendChild(d.cloneNode(!0)),appendContentToElement(e,l)}else appendContentToElement(this,l);Object.keys(s).forEach(e=>{this.addEventListener(e,s[e].bind(this))}),c&&this.setAttribute("aria-role",c);const e=Object.keys(i);if(s.childListChange){new MutationObserver(s.childListChange.bind(this)).observe(this,{childList:!0})}if(e.length){const t={};new MutationObserver(t=>{let n=!1,r=!1;t.forEach(t=>{n="value"===t.attributeChange,r=r||n||e.includes(t.attributeName)}),r&&this.queueRender&&this.queueRender(n)}).observe(this,{attributes:!0}),e.forEach(e=>{Object.defineProperty(this,e,{writeable:!0,enumerable:!1,get(){return"boolean"==typeof i[e]?this.hasAttribute(e):this.hasAttribute(e)?this.getAttribute(e):t[e]||i[e]},set(n){"boolean"==typeof i[e]?n!==this[e]&&(n?this.setAttribute(e,""):this.removeAttribute(e),this.queueRender&&this.queueRender("value"===e)):"object"!=typeof n&&`${n}`==`${this[e]}`||(null===n||void 0===n||"object"==typeof n?this.removeAttribute(e):this.setAttribute(e,n),t[e]=n,this.queueRender&&this.queueRender("value"===e))}})})}this.onMount&&this.onMount(),this.unMount&&unmountWatchList.push(this),this.queueRender&&this.queueRender()}};return Object.keys(a).forEach(e=>{u.prototype[e]=a[e]}),window.customElements.define(e,u),u},components={},component_timeouts=[],component_promises={},View=makeWebComponent("b8r-component",{attributes:{name:""},methods:{render(){this.name?b8r.insertComponent(this.name,this):b8r.removeComponent(this)}}}),makeComponent=function(e,t,n,r){let a,s,o,i=!1,l=!1;n||(n=uuid()),3===(s=t.split(/<style>|<\/style>/)).length?[,i,o]=s:o=t,3===(s=o.split(/<script>|<\/script>/)).length?[a,l]=s:a=o;const c=create("div");c.innerHTML=a;let d=()=>console.error("component",e,"cannot load properly");l&&l.match(/require\s*\(/)&&!l.match(/electron-require/)&&(console.error(`in component "${e}" replace require with await import()`),l=!1);try{d=!!l&&new AsyncFunction("component","b8r","find","findOne","data","register","get","set","on","touch",`${l}\n//# sourceURL=${e}(component)`)}catch(t){throw console.error("error creating load method for component",e,t,l),`component ${e} load method could not be created`}const u=`${e}-component`,h=!!i&&makeStyleSheet(i.replace(/_component_/g,u),u);findWithin(c,'[class*="_component_"]').forEach(e=>e.setAttribute("class",e.getAttribute("class").replace(/_component_/g,u)));const p={name:e,style:h,view:c,load:d,path:n.split("/").slice(0,-1).join("/")};return p.path,r&&(p._source=t),component_timeouts[e]&&clearInterval(component_timeouts[e]),components[e]&&(components[e].style&&components[e].style.remove(),console.warn("component %s has been redefined",e)),components[e]=p,find(`[data-component="${e}"]`).forEach(t=>{t.closest("[data-list]")||t.dataset.component!==e||async_update(!1,t)}),p},collapse=e=>{for(;e.match(/([^/]+\/\.\.\/)/);)e=e.replace(/([^/]+\/\.\.\/)/g,"");return e},component$1=(e,t,n=!1)=>{if(void 0===t&&(e=(t=e).split("/").pop()),!component_promises[e]||n){if(!t)throw`expected component ${e} to be defined`;t=collapse(t),component_promises[e]=new Promise(function(r,a){components[e]&&!n?r(components[e]):ajax(`${t}.component.html`).then(a=>r(makeComponent(e,a,t,n))).catch(n=>{delete component_promises[e],console.error(n,`failed to load component ${t}`),a(n)})})}return component_promises[e]},b8r$1={};function indexFromKey(e,t){if("number"==typeof t)return t;const[n,r]=t.split("=");return e.findIndex(e=>getByPath(e,n)==r)}Object.assign(b8r$1,_dom),Object.assign(b8r$1,_perf),Object.assign(b8r$1,_iterators),Object.assign(b8r$1,{on:on,off:off,enable:enable,disable:disable,trigger:trigger,callMethod:callMethod,implicitlyHandleEventsOfType:implicitlyHandleEventsOfType}),Object.assign(b8r$1,{addDataBinding:addDataBinding,removeDataBinding:removeDataBinding,getDataPath:getDataPath,getComponentId:getComponentId,getListInstancePath:getListInstancePath}),Object.assign(b8r$1,{onAny:onAny,offAny:offAny,anyListeners:anyListeners}),Object.assign(b8r$1,_registry),b8r$1.observe(()=>!0,(e,t)=>b8r$1.touchByPath(e,t)),b8r$1.keystroke=keystroke,b8r$1.modifierKeys=modifierKeys,Object.assign(b8r$1,_functions),b8r$1.cleanupComponentInstances=b8r$1.debounce(()=>{b8r$1.forEachKey(_component_instances,(e,t)=>{b8r$1.isInBody(e)&&e.dataset.componentId===t||delete _component_instances[t]}),b8r$1.models().forEach(e=>{"c#"!==e.substr(0,2)||_component_instances[e]||(b8r$1.call_if(`${e}.destroy`),b8r$1.remove(e,!1))})},100),Object.assign(b8r$1,{async_update:async_update,after_update:after_update,touchElement:touchElement,touchByPath:touchByPath}),b8r$1.force_update=(()=>{let e;for(;e=get_update_list();){const t=b8r$1.find("[data-list]").map(e=>({elt:e,list_binding:e.dataset.list}));let n=!1;for(;e.length;){const{path:r,source:a}=e.shift();try{r?(t.filter(e=>e.elt!==a&&e.list_binding.includes(r)).forEach(({elt:e})=>bindList(e)),n||(n=b8r$1.find("[data-bind]").map(e=>({elt:e,data_binding:e.dataset.bind}))),n.filter(e=>e.elt!==a&&e.data_binding.includes(r)).forEach(e=>e.dirty=!0)):b8r$1.bindAll(a)}catch(e){console.error("update error",e,{path:r,source:a})}}n&&n.forEach(({elt:e,dirty:t})=>t&&bind(e))}b8r$1.cleanupComponentInstances(),_after_update()}),_set_force_update(b8r$1.force_update),b8r$1.setByPath=function(...e){let t,n,r,a;if(2===e.length&&"object"==typeof e[1]&&!Array.isArray(e[1]))return[t,r]=e,void b8r$1.forEachKey(r,(e,n)=>b8r$1.setByPath(t,n,e));2===e.length||e[2]instanceof Element?([n,r,a]=e,n=b8r$1.resolvePath(n,a),[t,n]=pathSplit(n)):[t,n,r,a]=e,b8r$1.registered(t)?"object"==typeof n?b8r$1.set(t,n,a):b8r$1.set("["!==n[0]&&n?`${t}.${n}`:`${t}${n}`,r,a):console.error(`setByPath failed; ${t} is not a registered model`)},b8r$1.pushByPath=function(...e){let t,n,r,a;if(2===e.length||"function"==typeof e[2]?([n,r,a]=e,[t,n]=pathSplit(n)):[t,n,r,a]=e,b8r$1.registered(t)){const e=b8r$1.get(n?`${t}.${n}`:t);e.push(r),a&&a(e),b8r$1.touchByPath(t,n)}else console.error(`pushByPath failed; ${t} is not a registered model`)},b8r$1.unshiftByPath=function(...e){let t,n,r;if(2===e.length?([n,r]=e,[t,n]=pathSplit(n)):[t,n,r]=e,b8r$1.registered(t)){getByPath(b8r$1.get(t),n).unshift(r),b8r$1.touchByPath(t,n)}else console.error(`unshiftByPath failed; ${t} is not a registered model`)},b8r$1.removeListInstance=function(e){if(e=e.closest("[data-list-instance]")){const t=e.dataset.listInstance;try{const[,e,n,r]=t.match(/^([^.]+)\.(.+)\[([^\]]+)\]$/);b8r$1.removeByPath(e,n,r)}catch(e){console.error("cannot find list item for instance",t)}}else console.error("cannot remove list instance for",e)},b8r$1.removeByPath=function(...e){let t,n,r;if(2===e.length?([n,r]=e,[t,n]=pathSplit(n)):[t,n,r]=e,b8r$1.registered(t)){const e=getByPath(b8r$1.get(t),n),a=indexFromKey(e,r);Array.isArray(e)&&a>-1?e.splice(a,1):delete e[r],b8r$1.touchByPath(t,n)}},b8r$1.listItems=(e=>b8r$1.makeArray(e.children).filter(e=>e.matches("[data-list-instance]"))),b8r$1.listIndex=(e=>b8r$1.listItems(e.parentElement).indexOf(e)),b8r$1.getComponentData=((e,t)=>{const n=getComponentId(e,t);return n?b8r$1.get(n):null}),b8r$1.setComponentData=((e,t,n)=>{const r=getComponentId(e);b8r$1.setByPath(r,t,n)}),b8r$1.getData=(e=>{const t=b8r$1.getDataPath(e);return t?b8r$1.get(t,e):null}),b8r$1.getListInstance=(e=>{const t=b8r$1.getListInstancePath(e);return t?b8r$1.get(t,e):null}),document.body?implicit_event_types.forEach(e=>document.body.addEventListener(e,handle_event,!0)):document.addEventListener("DOMContentLoaded",()=>{implicit_event_types.forEach(e=>document.body.addEventListener(e,handle_event,!0))});const toTargets=_toTargets(b8r$1);b8r$1.onAny(["change","input"],"_b8r_._update_"),b8r$1.interpolate=((e,t)=>{let n;if(e.match(/\$\{[^{]*?\}/)){n=e;do{n=n.replace(/\$\{([^{]*?)\}/g,(e,n)=>{const r=b8r$1.get(n,t);return null!==r?r:""})}while(n.match(/\$\{[^{]*?\}/))}else{const r=splitPaths(e);if(r.indexOf("")>-1)throw`empty path in binding ${e}`;1===(n=r.map(e=>b8r$1.get(e,t))).length&&(n=n[0])}return n});const _unequal=(e,t)=>e!==t||e&&"object"==typeof e;function bind(e){if(e.closest("[data-component],[data-list]"))return;const t=getBindings(e),n=e._b8r_boundValues||(e._b8r_boundValues={}),r={};for(let a=0;a<t.length;a++){const{targets:s,path:o}=t[a],i=b8r$1.interpolate(o,e),l=n[o];if(_unequal(l,i)){r[o]=i;const n=s.filter(e=>toTargets[e.target]);n.length?n.forEach(t=>{toTargets[t.target](e,i,t.key)}):console.warn("unrecognized toTarget in binding",e,t[a])}}Object.assign(n,r)}b8r$1.show=show,b8r$1.hide=hide;const forEachItemIn=(e,t,n)=>{if(Array.isArray(e))for(let r=e.length-1;r>=0;r--){const a=e[r];n(a,t?`${t}=${getByPath(a,t)}`:r)}else if(e.constructor===Object){if(t)throw"id-path is not supported for objects bound as lists";const r=Object.keys(e);for(let t=r.length-1;t>=0;t--){const a=r[t];n(e[a],`=${a}`)}}else if(null!==e)throw"can only bind Array and Object instances as lists"};let id_count=0;function bindList(e,t){if(e.classList.add("-b8r-empty-list"),!e.parentElement||e.parentElement.closest("[data-component]")||e.parentElement.closest("[data-list]"))return;const[n,r]=e.dataset.list.split(":");let a,s,o;try{[,,a,o]=n.match(/^(([^()]*)\()?([^()]*)(\))?$/),o=o.split(","),s=o[0]}catch(e){console.error("bindList failed; bad source path",n)}t&&(s=t+s);const i=b8r$1.resolvePath(s,e);if(i!==s){let t=s=i;a&&(o[0]=s,t=`${a}(${o.join(",")})`),e.dataset.list=r?`${t}:${r}`:t}let l=b8r$1.get(s);if(!l)return;if("_auto_"===r)for(let e=0;e<l.length;e++)l[e]._auto_||(l[e]._auto_=++id_count);if(a){if(!b8r$1.get(a))return;if((()=>{try{const t=o.map(b8r$1.get),n=b8r$1.callMethod(a,...t,e);Array.isArray(l)&&n.length&&-1===l.indexOf(n[0])&&console.warn(`list filter ${a} returned a new object`+" (not from original list); this will break updates!"),l=n}catch(e){console.error(`bindList failed, ${a} threw error`,e)}})(),!l)throw"could not compute list; async filtered list methods not supported (yet)"}b8r$1.show(e);const c=e._b8r_listInstances||{},d=e._b8r_listInstances={},u=e.cloneNode(!0);u.classList.remove("-b8r-empty-list"),delete u.dataset.list,"OPTION"===e.tagName&&(e.setAttribute("disabled",""),e.textContent="",u.removeAttribute("disabled"));let h,p=e,m=!1;const f={};e.classList.toggle("-b8r-empty-list",!l.length),forEachItemIn(l,r,(t,n)=>{if(f[n])return void console.warn(`${n} not unique ${r} in ${e.dataset.list}`);f[n]=!0;const a=`${s}[${n}]`;void 0===(h=c[a])?(m=!0,(h=u.cloneNode(!0)).dataset.listInstance=a,h._b8r_listInstance=t,e.parentElement.insertBefore(h,p),resolveListInstanceBindings(h,a),b8r$1.bindAll(h)):(delete c[a],h.nextSibling!==p&&e.parentElement.insertBefore(h,p)),d[a]=h,p=h}),b8r$1.forEachKey(c,e=>{m=!0,e.remove()}),m&&b8r$1.trigger("change",e.parentElement),b8r$1.hide(e)}b8r$1.bindAll=((e,t)=>{loadAvailableComponents(e,t),findBindables(e).forEach(e=>bind(e)),findLists(e).forEach(e=>bindList(e,t))}),_b8r_(b8r$1),Object.assign(b8r$1,_ajax),Object.assign(b8r$1,_sort);const _path_relative_b8r=e=>e?Object.assign({},b8r$1,{_path:e,component:(...t)=>{const n=t[1]?1:0;let r=t[n];return-1===r.indexOf("://")&&(r=`${e}/${r}`,t[n]=r),b8r$1.component(...t)}}):b8r$1;function loadAvailableComponents(e,t){b8r$1.findWithin(e||document.body,"[data-component]",!0).forEach(e=>{if(!e.closest("[data-list]")&&!e.dataset.componentId){const n=e.dataset.component;b8r$1.insertComponent(n,e,t)}})}Object.assign(b8r$1,{component:component$1,makeComponent:makeComponent}),b8r$1.components=(()=>Object.keys(components)),b8r$1._DEPRECATED_COMPONENTS_PASS_DOWN_DATA=!1;const inheritData=e=>{const t=["destroy"],n=b8r$1._DEPRECATED_COMPONENTS_PASS_DOWN_DATA?"[data-path],[data-list-instance],[data-component-id]":"[data-path],[data-list-instance]",r=e.closest(n);if(r){const e=b8r$1.get(r.dataset.componentId||b8r$1.getDataPath(r));return b8r$1.filterObject(e||{},(e,n)=>!t.includes(n)||"function"!=typeof e)}return null};let component_count=0;const _component_instances={};b8r$1.insertComponent=async function(e,t,n){const r="string"==typeof n?n:b8r$1.getDataPath(t);if(t){if(!b8r$1.isInBody(t))return}else t=b8r$1.create("div");if("string"==typeof e){if(!components[e])return component_timeouts[e]||(component_timeouts[e]=setTimeout(()=>console.error("component timed out: ",e),5e3)),n&&saveDataForElement(t,n),void(t.dataset.component=e);e=components[e]}t.dataset.component&&delete t.dataset.component,n&&!r||(n=dataForElement(t)||inheritData(t)||{}),null===t.parentElement&&document.body.appendChild(t);const a=b8r$1.fragment(),s="c#"+e.name+"#"+ ++component_count;if(e.view.children.length){t.dataset.componentId?t.querySelector("[data-children]")?b8r$1.moveChildren(t.querySelector("[data-children]"),a):b8r$1.empty(t):b8r$1.moveChildren(t,a);const n=e.view.querySelector("[data-parent]")||e.view;b8r$1.copyChildren(n,t),replaceInBindings(t,"_component_",s),r&&replaceInBindings(t,"_data_",r);const o=b8r$1.findOneWithin(t,"[data-children]");a.firstChild&&o&&(b8r$1.empty(o),b8r$1.moveChildren(a,o))}t.dataset.componentId=s,_component_instances[s]=t,b8r$1.makeArray(t.classList).forEach(e=>{"-component"===e.substr(-10)&&t.classList.remove(e)}),t.classList.add(e.name+"-component"),r&&(t.dataset.path=r);const o=e=>b8r$1.register(s,e);if(n=Object.assign({},n,{data_path:r,component_id:s}),e.load){const r=e=>b8r$1.getByPath(s,e),a=(...e)=>{b8r$1.setByPath(s,...e),("value"===e[0]||e[0].hasOwnProperty("value"))&&b8r$1.trigger("change",t)},i=(...e)=>b8r$1.on(t,...e),l=e=>b8r$1.touchByPath(s,e);b8r$1.register(s,n,!0);try{await e.load(t,_path_relative_b8r(e.path),e=>b8r$1.findWithin(t,e),e=>b8r$1.findOneWithin(t,e),n,o,r,a,i,l,e)}catch(t){console.error("component",e.name,"failed to load",t)}}else b8r$1.register(s,n,!0);b8r$1.bindAll(t)},b8r$1.wrapWithComponent=((e,t,n,r)=>{const a=b8r$1.create("div");return r&&b8r$1.forEachKey(r,(e,t)=>a.setAttribute(t,e)),b8r$1.wrap(t,a),b8r$1.insertComponent(e,a,n),a}),b8r$1.removeComponent=(e=>{e.dataset.componentId&&(delete e.dataset.componentId,b8r$1.makeArray(e.classList).forEach(t=>{/-component$/.test(t)&&(e.classList.remove(t),b8r$1.empty(e))}),b8r$1.cleanupComponentInstances())}),b8r$1.componentOnce=function(...e){this.component(...e).then(e=>{b8r$1.findOne(`[data-component-id*="${e.name}"]`)||b8r$1.insertComponent(e)})};var b8r$2=Object.freeze({default:b8r$1}),dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,r=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};return function(a,s,o){var i=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(a)||/\d/.test(a)||(s=a,a=void 0),a=a?new Date(a):new Date,isNaN(a))throw SyntaxError("invalid date");"UTC:"==(s=String(i.masks[s]||s||i.masks.default)).slice(0,4)&&(s=s.slice(4),o=!0);var l=o?"getUTC":"get",c=a[l+"Date"](),d=a[l+"Day"](),u=a[l+"Month"](),h=a[l+"FullYear"](),p=a[l+"Hours"](),m=a[l+"Minutes"](),f=a[l+"Seconds"](),g=a[l+"Milliseconds"](),b=o?0:a.getTimezoneOffset(),y={d:c,dd:r(c),ddd:i.i18n.dayNames[d],dddd:i.i18n.dayNames[d+7],m:u+1,mm:r(u+1),mmm:i.i18n.monthNames[u],mmmm:i.i18n.monthNames[u+12],yy:String(h).slice(2),yyyy:h,h:p%12||12,hh:r(p%12||12),H:p,HH:r(p),M:m,MM:r(m),s:f,ss:r(f),l:r(g,3),L:r(g>99?Math.round(g/10):g),t:p<12?"a":"p",tt:p<12?"am":"pm",T:p<12?"A":"P",TT:p<12?"AM":"PM",Z:o?"UTC":(String(a).match(t)||[""]).pop().replace(n,""),o:(b>0?"-":"+")+r(100*Math.floor(Math.abs(b)/60)+Math.abs(b)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return s.replace(e,function(e){return e in y?y[e]:e.slice(1,e.length-1)})}}();dateFormat.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return dateFormat(this,e,t)};var date_format=Object.freeze({});export default b8r$1;
