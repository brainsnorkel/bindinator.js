<!-- bindinator.js Copyright (c) 2016 Tonio Loewald -->
<style>
	.context-menu > div > a {
		display: block;
		cursor: pointer;
	}

	.context-menu > div > a:hover {
		background-color: black;
	}

	.context-menu > div > header {
		border-bottom: 1px solid rgba(255,255,255,0.2);
	}

	.context-menu > div > footer {
		border-top: 1px solid rgba(255,255,255,0.2);
	}
</style>
<div class="context-menu" data-component="annotation" data-event="keyup(Escape):_component_.hide">
	<header>
		Header
	</header>
	<a data-list="_DATA_" data-event="keyup(ArrowUp):_component_.up;keydown(ArrowDown):_component_.down;keydown(Space),click:_component_.action" data-bind="text=.caption" tabindex=0>Menu Item</a>
	<footer>
		Footer
	</footer>
</div>
<script>
	/* globals b8r, component, data, find, findOne, console, window */
	'use strict';

	b8r.component('annotation', 'components/annotation');

	// there can be only one!
	b8r.find('.context-menu').forEach(elt => elt.parentElement === component || elt.parentElement.remove());
	b8r.bindAll(component, data.options || [{caption: 'Option 1'}, {caption: 'Option 2'}, {caption: 'Option 3'}]);
	b8r.onAny('mousedown', 'context-menu', 'hide');
	findOne('[tabindex]').focus();

	function hide(evt) {
		if(!component.contains(evt.target)) {
			component.remove();	
			b8r.offAny('mousedown', 'context-menu', 'hide');
			return true;
		}
	}

	b8r.register('context-menu', {hide});

	// this is kind of a hack
	b8r.trigger('show', findOne('[data-event*="show"]'));
	
	register({
		hide,
		up: evt => evt.target.previousSibling.focus(),
		down: evt => evt.target.nextSibling.focus(),
		action: evt => console.log(evt),
	});
</script>