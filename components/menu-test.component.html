<!-- bindinator.js Copyright (c) 2016 Tonio Loewald -->
<style>
	.demo-area {
		text-align: center;
		border: 1px solid rgba(0,0,0,0.5);
		padding: 20px;
		cursor: pointer;
	}

	[data-tooltip] {
		display: inline-block;
		border-bottom: 1px dotted green;
		padding: 4px;
		margin: -4px;
	}

	.annotation.gone {
		opacity: 0;
		transition: 0.5s ease-in;
	}
</style>
<div>
	<h4>Menu Test</h4>
	<p>
		Testbed for annotations and menus (annotations being the general term for widgets that pin to other DOM elements).
	</p>
	<div class="demo-area popover" data-event="mouseup:_component_.context_menu">
		Click to show Context Popover Menu
	</div>
	<p class="result"></p>
	<div class="demo-area">
		Two of these <span data-tooltip="Word!">words</span> are <span data-tooltip="This is an annotation!">annotated</span></span>.
	</div>
</div>
<script>
	var result = findOne('.result');

	var tooltip;
	var target;
	var last_target;

	function showTip(evt) {
		if(!target && evt.target.matches('[data-tooltip]')) {
			target = evt.target;
			if (target === last_target) {
				tooltip.classList.remove('gone');
				return;
			} else if (tooltip) {
				tooltip.remove();
				tooltip = null;
			}
			const content = b8r.create('div');
			content.style.padding = '4px 8px';
			content.textContent = target.getAttribute('data-tooltip');
			b8r.component('annotation', 'components/annotation').then(note => {
				tooltip = b8r.insertComponent('annotation', false, {target, content});
			});
		}
	}

	function hideTip(evt) {
		if (evt.target === target) {
			tooltip.classList.add('gone');
			last_target = target;
			target = null;
		}
	}

	b8r.register('tooltips', {showTip, hideTip});
	b8r.on(document.body, 'mouseover', 'tooltips', 'showTip');
	b8r.on(document.body, 'mouseout', 'tooltips', 'hideTip');

	register({
		context_menu: function(evt) {
			b8r.component('context-menu', 'components/context-menu').then(component => {
				var target = findOne('.popover');
				b8r.insertComponent(component, false, {target});
			});
		}
	});
</script>