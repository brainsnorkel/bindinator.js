<style>
	.kitchen-sink {
		padding: 0 8px;
		position: relative;
		border: 1px solid rgba(0,0,0,0.25);
	}

	.kitchen-sink > hr {
		margin-left: -8px;
		margin-right: -8px;
	}

	.kitchen-sink > .menubar {
		background: #eee;
	}
</style>
<div class="kitchen-sink">
	<ul class="menubar" data-event="mouseup,focus,keydown(Space):menubar.disclose;mousedown:menubar.mousedown;blur:menubar.deactivate;keydown(Escape):menubar.escape">
		<li>
			File
			<ul>
				<li>
					<span>New</span>
					<span class="shortcut">meta-N</span>
				</li>
				<li>
					<span>Open…</span>
					<span class="shortcut">meta-O</span>
				</li>
				<li>
					<span>Open Recent</span>
					<ul>
						<li>Recent File</li>
						<li>Another Recent File</li>
					</ul>
				</li>
				<li>
					<span>Save</span>
					<span class="shortcut">meta-S</span>
				</li>
				<li>
					<span>Save As…</span>
					<span class="shortcut">meta-shift-S</span>
				</li>
				<li class="separator"></li>
				<li>
					<span>Quit</span>
					<span class="shortcut">meta-Q</span>
				</li>
			</ul>
		</li>
		<li>
			Edit
			<ul>
				<li>
					<span>Undo</span>
					<span class="shortcut">meta-Z</span>
				</li>
				<li class="separator"></li>
				<li>
					<span>Cut</span>
					<span class="shortcut">meta-X</span>
				</li>
				<li>
					<span>Copy</span>
					<span class="shortcut">meta-C</span>
				</li>
				<li>
					<span>Paste</span>
					<span class="shortcut">meta-V</span>
				</li>
			</ul>
		</li>
		<li>
			Format
			<ul>
				<li>
					<span>Document</span>
				</li>
				<li>
					<span>Section</span>
				</li>
				<li>
					<span>Page</span>
				</li>
				<li>
					<span>Paragraph</span>
				</li>
				<li>
					<span>Character</span>
					<ul>
						<li>
							<v>Bold</v>
						</li>
						<li>
							<i>Italic</i>
						</li>
						<li>
							<u>Underline</u>
						</li>
						<li class="separator"></li>
						<li>
							<span>Plain</span>
						</li>
					</ul>
				</li>
			</ul>
		</li>
	</ul>
	<div style="height: 32px">&nbsp;</div>
	<div class="toolbar">
	</div>
	<button class="cancel">Cancel</button> <button>Whatever</button> <button class="default">Default</button>
	<hr>
	<select>
		<option selected>Default</option>
		<option>Another Option</option>
		<option>Yet Another Option</option>
	</select>
	<select multiple>
		<option>Default</option>
		<option selected>Another Option</option>
		<option>Yet Another Option</option>
		<option selected>And Yet Another Option</option>
		<option>Final Option</option>
	</select>
	<hr>
	<textarea>Text Area</textarea>
	<input placeholder="input field">
	<input class="search" placeholder="search field">
	<hr>
	<label>
		Range
		<input type="range">
	</label>
	<label>
		Date
		<input type="date" value="2014-04-01">
	</label>
	<label>
		Number
		<input type="number" value="5">
	</label>
	<label>
		Color
		<input type="color" value="#ff0000">
	</label>
	<br>
	<label>
		Progress
		<progress value="33" max="100"></progress>
	</label>
	<br>
	<form onsubmit="return false;">
		<label>
			What is your quest?
			<input>
		</label><br>
		<label>
			What is the average airspeed of an unladen swallow?
			<input>
		</label>
		<fieldset>
			<label>
				What is your favorite color?
			</label>
			<label>
				<input name="favorite-color" value="red" type="radio">
				Red
			</label>
			<label>
				<input name="favorite-color" value="blue" type="radio">
				Blue
			</label>
			<label>
				<input name="favorite-color" value="pink" type="radio">
				Pink
			</label>
		</fieldset>
		<button type="cancel">Cancel</button>
		<button type="submit">OK</button>
	</form>
</div>
<script>
	// menubar stuff
	find('.shortcut').forEach(elt => {
		var caption = elt.textContent.split('-');
		caption.forEach((s, i) => {
			caption[i] = b8r.modifierKeys[s] || s;
		});
		elt.textContent = caption.join('');
	});
	function deactivate_menubar(elt_in_menubar) {
		b8r.findWithin(elt_in_menubar.closest('.menubar'), '.disclosed').forEach(elt => elt.classList.remove('disclosed'));
		b8r.findWithin(elt_in_menubar.closest('.menubar'), '.active').forEach(elt => elt.classList.remove('active'));
	}
	b8r.makeArray(findOne('.menubar').querySelectorAll('li:not(.separator)')).forEach(elt => elt.setAttribute('tabindex', 0));
	b8r.register('menubar', {
		mousedown(evt) {
			const menuitem = evt.target.closest('li');
			if(b8r.makeArray(menuitem.children).filter(elt => elt.matches('ul')).length === 0) {
				menuitem.classList.add('active');
			}
		},
		disclose(evt) {
			deactivate_menubar(evt.target);
			const menuitem = evt.target.closest('li');
			const submenu = b8r.makeArray(menuitem.children).filter(elt => elt.matches('ul'));
			if (submenu.length === 1) {
				evt.target.classList.add('disclosed');
			} else if (evt.type !== 'focus') {
				setTimeout(() => {
					b8r.findWithin(menuitem.closest('.menubar'), '.disclosed').forEach(elt => elt.classList.remove('disclosed'));
				}, 500);
			}
			menuitem.classList.add('disclosed');
			b8r.findAbove(menuitem, 'li', '.menubar').forEach(elt => elt.classList.add('disclosed'));
		},
		deactivate(evt) {
			// FIXME -- Firefox doesn't support relatedTarget
			if(evt.relatedTarget && !evt.relatedTarget.closest('.menubar')) {
				deactivate_menubar(evt.target);
			}
		},
		escape(evt) {
			// FIXME -- move focus to next element after menubar?
			deactivate_menubar(evt.target);
		}
	});
</script>